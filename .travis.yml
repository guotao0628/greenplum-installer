sudo: required

language: bash

env:
  global:
      - DEPLOY_HOST=rpm.palette-software.com
      - DEPLOY_PATH=/var/palette-rpm-repo
      - DEPLOY_USER=palette-rpm

      # travis encrypt DEPLOY_PASS=...
      - secure: "wx129K8BPCWWqhD9N62BR56XaASwnjRrBtA4HXiFlwIYFOLRGtcjO861j44YACEfanT3YRQcqqljh4s8m56v5CFpk8c9JGymArnccaR92IGfYXs854EE8l2NzqxZpDJReOc0QSKfTx61GWl4f2syJ8OdZNqQD4Z4ac8uMiBdqmi3fsJM59wNpNkJ97g75NcGqCu9CGuMwzsnMBQzUM8lSeSlJYdYD0OE5A3zl/pwKFc9aDt8SP+KrFoEij3VTWXNC4gvk1Ov8df6D8e2+zBmGKZenzJGEtXUYyPrpDqCvjSh4gV8By5EV6Lnh8Fs8Vg6W3EpvICc9m6abKs9NlKhs9z1v20ZUGmvNN1Bm8sibSv65spKe41sajoa6jTf2GTYmXZhpC4DuSR/PK6Ru18fl7yo4Mxk5usZSth+4y7qdhuAExRvYzJ7PxLmmWP1ZI4NaXYJA4URgeFXsvFkLnuMpWp0I0tFX87KZt/7XXW5NNSsDVxoSB3nojqlrTb4HFrTrTxdnv3LW+n4/gJsoeOixiWidgVqgG7ZFCYNhjPfv5ai3QxlLNguwu+nK8NKpIxX5dQCShApvjpp++WWeaQC0/vV50nAKdckKgULC2HU7PXXhwANlgcfFKE5TGm5wPWd79ZunQHHuomaIuMSUHwpcQBKgOzC5oZF4iE6Lp4qngk="

# install the RPM package
addons:
  apt:
    packages:
      - rpm
      # To deploy the rpms, we need to ssh into places, and we dont want to store keys for now
      - sshpass

before_install:
  # Download Git Large File Storage extension as the Greenplum installer found in the Github repo is stored there
  - curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
  - sudo apt-get install git-lfs=1.4.4

  # And now populate the large files into the repo
  - git lfs pull

script:
  - ./build.sh

deploy:
  provider: script
  script: "./deploy.sh"
  skip_cleanup: true
  on:
    branch: master
    tags: false

notifications:
  email:
    on_success: never
    on_failure: never
